# Tidyverse

```{r}
#| echo: false
#| message: false
#| warning: false

library(kableExtra)
```

O `tidyverse` [@wickhamWelcomeTidyverse2019] √© um ecossistema de pacotes R que re√∫ne as tarefas essenciais de qualquer fluxo de trabalho em ci√™ncia de dados: importa√ß√£o, organiza√ß√£o, manipula√ß√£o, visualiza√ß√£o e programa√ß√£o. Seu principal objetivo √© criar uma sintaxe consistente e leg√≠vel, facilitando a comunica√ß√£o entre quem escreve o c√≥digo e quem o executa. Note-se que, embora o tidyverse cubra grande parte do fluxo de trabalho, ele n√£o inclui ferramentas espec√≠ficas de modelagem estat√≠stica.

Para facilitar essa integra√ß√£o, o `tidyverse` utiliza intensamente do operador pipe[^03-tidyverse-1] (`%>%`) , que passa o resultado de uma etapa diretamente para a pr√≥xima, evitando aninhamentos confusos. Ao carregar o pacote, diversos m√≥dulos s√£o automaticamente disponibilizados:

[^03-tidyverse-1]: A partir da vers√£o 4.1 do R, existe tamb√©m o operador pipe nativo `|>`. No entanto, nesta apostila manteremos o uso de `%>%`, amplamente adotado no contexto do tidyverse.

```{r, warning=FALSE, message=FALSE}
library(tidyverse)
```

``` text
-- Attaching core tidyverse packages ------ tidyverse 2.0.0 --
‚úî dplyr     1.1.4     ‚úî readr     2.1.5
‚úî forcats   1.0.0     ‚úî stringr   1.5.1
‚úî ggplot2   3.5.2     ‚úî tibble    3.2.1
‚úî lubridate 1.9.4     ‚úî tidyr     1.3.1
‚úî purrr     1.0.4     
-- Conflicts ------------------------------ tidyverse_conflicts() --
x dplyr::filter() masks stats::filter()
x dplyr::lag()    masks stats::lag()
i Use the conflicted package (http://conflicted.r-lib.org/) 
  to force all conflicts to become errors
```

\noindent Entre os principais est√£o:

-   `ggplot2` (visualiza√ß√£o de dados);
-   `dplyr` (manipula√ß√£o de dados);
-   `tidyr` (formata√ß√£o "*long*"/"*wide*");
-   `readr` (leitura eficiente de arquivos de texto);
-   `tibble` (vers√£o moderna do `data.frame`);
-   `purrr` (programa√ß√£o funcional);
-   `stringr`, `forcats` e outros.

Como dito, muitos pacotes definem fun√ß√µes com nomes id√™nticos, sendo costatumum que o console exiba nomes como:

``` text
The following objects are masked from ‚Äòpackage:stats‚Äô:
    filter, lag
```

Um pilar do `tidyverse` √© a ado√ß√£o do princ√≠pio `tidy` [@wickhamTidyData2014], em que:

-   Cada vari√°vel ocupa uma coluna;
-   Cada observa√ß√£o ocupa uma linha;
-   Cada tipo de entidade observacional fica em sua pr√≥pria tabela.

Nesse contexto, a **entidade observacional** √© o conceito central que define o que uma linha representa. Pode ser um paciente em um estudo cl√≠nico, um pa√≠s em dados econ√¥micos ou, como nos exemplos a seguir:

-   **Aves**: Cada linha corresponde a uma √∫nica ave, registrando suas caracter√≠sticas (peso, envergadura, esp√©cie, etc.).
-   **Plantas**: Cada linha representa um vaso de planta em um experimento (altura, n√∫mero de folhas, tipo de solo, etc.).

A estrutura de dados que implementa essa filosofia no `tidyverse` √© o `tibble`. Ele √© a vers√£o moderna do `data.frame`, projetado para ser mais pr√°tico e informativo, exibindo resumos concisos dos dados e fornecendo diagn√≥sticos mais √∫teis.

Uma vez apresentada a filosofia e a estrutura de dados do `tidyverse`, o foco se volta para a aplica√ß√£o pr√°tica. A seguir, a concentra√ß√£o do material residir√° nos dois pacotes centrais do `tidyverse`: o `dplyr`, para manipula√ß√£o de dados, e o `ggplot2`, para a cria√ß√£o de gr√°ficos.

## Manipula√ß√£o de dados com o pacote `dplyr`

O `dplyr` √© um pacote do `tidyverse` que fornece um conjunto de ferramentas robustas e intuitivas para manipula√ß√£o de dados. Os comandos oferecidos soam um tanto quanto intuitivos, correspondendo a√ß√µes comuns na √°rea de an√°lise de dados. Para explorar as principais fun√ß√µes ser√° utilizado o *dataset* `penguins`, focando em processos de filtragem, organiza√ß√£o, transforma√ß√£o e resumos dos dados, permitindo responder a perguntas b√°sicas sobre a biologia e ecologia dos pinguins.

### **Conhe√ßa os pinguins** üêß

![Obra de¬†\@allison_horst.](images/clipboard-3055016893.png)

Os dados `palmerpenguins` cont√™m medi√ß√µes de tamanho de tr√™s esp√©cies de pinguins observadas em tr√™s ilhas no arquip√©lago Palmer, na Ant√°rtida.

Esses dados foram coletados entre 2007 e 2009 pela Dra. Kristen Gorman com o Programa de Pesquisa Ecol√≥gica de Longo Prazo da Esta√ß√£o Palmer , parte da Rede de Pesquisa Ecol√≥gica de Longo Prazo dos EUA . Os dados foram importados diretamente do Portal de Dados da Iniciativa de Dados Ambientais (EDI) e est√£o dispon√≠veis para uso sob licen√ßa CC0 (‚ÄúSem Direitos Reservados‚Äù), de acordo com a Pol√≠tica de Dados da Esta√ß√£o Palmer.

O primeiro passo a ser feito √© instalar a biblioteca `palmerpenguins` e, em seguida, carreg√°-la no ambiente de trabalho, para que possamos realizar uma inspe√ß√£o inicial na estrutura dos dados.

```{r dataset-ins}
#| eval: false
install.packages("palmerpenguins") # Realizar apenas uma √∫nica vez
```

```{r, message=FALSE}
#| warning: false
library(palmerpenguins)
```

![Terminologia das partes do corpo de um pinguim.](images/clipboard-786638237.png){fig-align="center"}

\noindent Para carregarmos os dados sobre pinguins no ambiente de trabalho, podemos utilizar a fun√ß√£o `data()`:

```{r}
data("penguins", package = "palmerpenguins")
```

Podemos observar que no painel **Environment** do RStudio, aparece o objeto `penguins`, isso significa que o conjunto de dados est√° carregado no ambiente de trabalho e podemos dar in√≠cio nas inspe√ß√µes. O primeiro comando que ser√° visto √© o `glimpse()`. Ele exibe, de maneira pr√°tica e r√°pida, a estrutura do *dataset* como: dimens√£o (n√∫mero de linhas e colunas), o nome de cada coluna, o tipo de dado de cada coluna e as primeiras observa√ß√µes.

```{r}
glimpse(penguins)
```

A sa√≠da deste comando revela que existem 344 observa√ß√µes e 8 vari√°veis, sendo elas `species`, `island`, `bill_length_mm`, `flipper_length_mm`, `body_mass_g`, `sex` e `year`, com seus respectivos tipos, como `factor` para `species` e `numeric` para `bill_length_mm`. Al√©m disso, √© poss√≠vel observar dados ausentes em algumas vari√°veis, representados por `NA`. Em geral, nos *datasets* dispon√≠veis em pacotes R, √© poss√≠vel utilizar o comando `help(penguins)` para buscar informa√ß√µes sobre o conjunto de dados que ser√° trabalhado.

Executando o comando de ajuda, s√£o obtidas as seguintes informa√ß√µes sobre as vari√°veis:

-   `species`: um fator que denota a esp√©cie do pinguim (Ad√©lie, Chinstrap ou Gentoo).
-   `island`: um fator que denota ilhas no Arquip√©lago Palmer na Ant√°rtica (Biscoe, Dream ou Torgersen).
-   `bill_length_mm`: um n√∫mero que representa o comprimento do bico (em mil√≠metros).
-   `bill_depth_mm`: um n√∫mero que representa a profundidade do bico (em mil√≠metros).
-   `flipper_length_mm`: um n√∫mero que representa o comprimento da nadadeira (em mil√≠metros).
-   `body_mass_g`: um n√∫mero inteiro que representa a massa do animal (em gramas).
-   `sex`: um fator que representa o sexo do animal (feminino ou masculino).
-   `year`: um n√∫mero inteiro que denota o ano de estudo (2007, 2008 ou 2009).

Adicionalmente, tamb√©m √© informado que os dados foram originalmente publicados no estudo de @gormanEcologicalSexualDimorphism2014 e que essa pesquisa fez parte do programa *Palmer Station Long-Term Ecological Research* (LTER). Isso significa que o conjunto de dados que est√° sendo utilizado possui uma origem cient√≠fica real, ligada a quest√µes sobre como o ambiente e as diferen√ßas entre sexos afetam a vida dessas aves.

A segunda fun√ß√£o que ser√° vista √© o `select()`. Frequentemente, um conjunto de dados cont√©m mais informa√ß√µes do que o necess√°rio para uma an√°lise espec√≠fica. Com isso em mente, a fun√ß√£o `select()` permite-nos selecionar colunas de interesse. Em geral, os argumentos s√£o os nomes das colunas.

```{r}
penguins %>% 
  select(species, island, sex)
```

\noindent O `dplyr` tamb√©m oferece "seletores auxiliares" que tornam a sele√ß√£o mais poderosa e flex√≠vel. Por exemplo, caso desejarmos selecionar todas as medidas biom√©tricas contidas no *dataset* que terminam com `_mm`, √© poss√≠vel usar a fun√ß√£o-argumento `ends_with()` dentro de `select()`:

```{r}
penguins %>% 
  select(
    body_mass_g, ends_with("_mm")
  )
```

\noindent Outros seletores √∫teis incluem `starts_with()` e `contains()`. Para remover colunas, utiliza-se o sinal de menos (`-`). Por exemplo, deseja-se remover as colunas `ano` e `island`:

```{r}
penguins %>% 
  select(-year, -island)
```

Antes prosseguirmos para a pr√≥xima fun√ß√£o, vale destacar que o conjunto de dados `penguins` √© um objeto `tibble` dentro do R e, portanto, por mais que existam 344 observa√ß√µes, o `tibble` enxuga a visualiza√ß√£o para somente 10, al√©m de indicar quantas linhas ainda existem.

A terceira fun√ß√£o √© o `filter()`. Enquanto `select()` trabalha nas colunas, o `filter()` trabalha nas linhas, permitindo-nos manter apenas as observa√ß√µes que satisfazem certas condi√ß√µes. √â aqui que √© poss√≠vel responder perguntas investigadas com rela√ß√£o aos dados. Por exemplo, para encontrar todos os pinguins da esp√©cie Adelie que vivem na ilha Torgersen:

```{r}
penguins %>% 
  filter(
      species == "Adelie", island == "Torgersen"
    )
```

Neste exemplo, as condi√ß√µes separadas por v√≠rgula s√£o unidas por um "E" l√≥gico. Tamb√©m √© poss√≠vel utilizar o "OU" l√≥gico para determinar pinguins mais pesados (acima de 6000g) ou com bicos muito longos (mais de 55mm) atrav√©s do conectivo `|`:

```{r}
penguins %>% 
  filter(
    body_mass_g > 6000 | bill_length_mm > 55
  )
```

O `filter()` tamb√©m permite encontrar valores ausentes (`NA`s) em conjunto da fun√ß√£o `is.na()`. Por exemplo, deseja-se verificar quais pinguins n√£o tiveram seu sexo registrado:

```{r}
penguins %>% 
  filter(is.na(sex))
```

A interpreta√ß√£o do `NA` √© relativa ao contexto dos dados. No caso das observa√ß√µes sobre os pinguins, os valores ausentes na vari√°vel `sex` permite identificar pinguins que n√£o tiveram o sexo avaliado, tornando um prov√°vel erro frustrante de coleta de dados para um objeto de investiga√ß√£o. O pacote `tidyr`, tamb√©m do `tidyverse`, oferece a fun√ß√£o `drop_na()`, que remove quaisquer linhas que contenham `NA`s, permitindo a cria√ß√£o de um *dataset* auxiliar:

```{r}
penguins_completo <- penguins %>% 
  drop_na()
```

A quarta fun√ß√£o que ser√° apresentada √© `arrange()`, que permite reordenar as linhas do dataframe com base nos valores de uma ou mais colunas. Isso √© √∫til para encontrar extremos ou simplesmente para organizar a sa√≠da de uma forma mais l√≥gica. Para encontrar os pinguins mais leves, ordenamos pela massa corporal em ordem crescente (o padr√£o):

```{r}
penguins %>% 
  arrange(body_mass_g)
```

\noindent Para ordenar os valores em ordem decrescente (do maior para o menor), utilizamos a fun√ß√£o auxiliar `desc()`, desta maneira, encontramos os pinguins mais pesados:

```{r}
penguins %>% 
  arrange(desc(body_mass_g))
```

\noindent Tamb√©m √© poss√≠vel ordenar m√∫ltiplas colunas. Por exemplo, para encontrar o pinguim mais pesado dentro de cada esp√©cie:

```{r}
penguins %>% 
  arrange(
    species, # Primeiro por esp√©cie
    desc(body_mass_g) # Depois por massa decrescente
  )
```

A quinta fun√ß√£o e, com certeza, uma das mais funcionais √© a `mutate()`. Ela permite criar novas colunas (vari√°veis) que s√£o fun√ß√µes de colunas j√° existentes, sem modificar as originais. Por exemplo, suponha que desejamos mostrar somente as esp√©cies e massas de pinguins em quilogramas (kg):

```{r}
penguins %>% 
  mutate(body_mass_kg = body_mass_g/1000) %>% 
  select(species, body_mass_kg)
```

\noindent Podemos usar `mutate()` para criar categorias. A fun√ß√£o `case_when()` √© extremamente √∫til para criar classifica√ß√µes baseadas em condi√ß√µes l√≥gicas., Suponha que desejamos criar uma categoria de tamanho baseada na massa corporal:

```{r}
penguins %>% 
  mutate(
    size_category = case_when(
      body_mass_g > 4750 ~ "Grande",
      body_mass_g < 3500 ~ "Pequeno",
      TRUE ~ "M√©dio"
    )
  ) %>% 
  select(
    species, body_mass_g, size_category
  )
```

As fun√ß√µes `group_by()` e `summarise()` formam uma dupla formid√°vel para agrupar e resumir os dados, pertencendo ao cora√ß√£o da an√°lise de dados. A fun√ß√£o `summarise()` serve para calcular estat√≠sticas resumidas (como m√©dia, total, m√≠nimo etc.) e, quando usada em conjunto com `group_by()` permite gerar resumos por grupo.

Inicialmente, vamos utilizar o `summarise()` no *dataset* completo para obter estat√≠sticas globais. N√£o obstante, √© bom frisar a utiliza√ß√£o do argumento `na.rm = TRUE` para instruir a remo√ß√£o dos valores `NA`.

```{r}
penguins %>% 
  summarise(
    massa_media = mean(body_mass_g, na.rm = TRUE),
    nadadeira_max = max(flipper_length_mm, na.rm = TRUE)
  )
```

No entanto, essas m√©tricas n√£o fornecem informa√ß√µes com rela√ß√£o as esp√©cies de pinguins. Para resolver isso e possibilitar que mais perguntas sejam respondidas, a fun√ß√£o `group_by()` permite que o R fa√ßa opera√ß√µes em subconjuntos. Por exemplo, suponha que desejamos determinar qual √© a massa corporal por esp√©cie:

```{r}
penguins %>% 
  group_by(species) %>% 
  summarise(
    massa_media_g = mean(body_mass_g, na.rm = TRUE)
  )
```

\noindent Podemos fazer agrupamentos por m√∫ltiplas vari√°veis para investiga√ß√µes mais profundas. Por exemplo, considere que um pesquisador deseja explorar o dimorfismo sexual. Para isso, estat√≠sticas por esp√©cie e sexo ser√£o calculadas.

```{r}
#| results: hide
tabela_resumo <- penguins %>% 
  drop_na(sex) %>% 
  group_by(species, sex) %>% 
  summarise(
    contagem = n(),
    massa_media_g = mean(body_mass_g),
    massa_dp_g = sd(body_mass_g),
    comp_bico_medio_mm = mean(bill_length_mm),
    .groups = "drop"
  )
tabela_resumo
```

```{r}
#| echo: false
#| label: tbl-tabela-resumo1
#| tbl-cap: "Estat√≠sticas descritivas de caracter√≠sticas biom√©tricas de pinguins, agrupadas por esp√©cie e sexo."
#| tbl-pos: "H"

tabela_resumo %>% 
  kable(
    col.names = c("Esp√©cies", "Sexo", "Contagem",
                  "Massa m√©dia (g)", 
                  "Massa Desvio-padr√£o (g)",
                  "Comprimento m√©dio do bico (mm)"),
    align = c(rep("l", 2), rep("c", 4)),
    booktabs = TRUE,
    format = "latex",
    digits = 2
  ) %>% 
  kable_styling(
    latex_options = c("striped", "scale_down"),
    full_width = FALSE
  )
```

\noindent Vale refor√ßar que a @tbl-tabela-resumo1 foi gerada usando o `dplyr`, com as fun√ß√µes auxiliares `n()` para realizar a contagem de observa√ß√µes em cada grupo e `drop_na(sex)` para remover as observa√ß√µes onde o sexo √© desconhecido, permitindo avaliar dimorfismo sexual em todas as tr√™s esp√©cies, especialmente na massa corporal. O grande potencial dessa tabela √© obter respostas como:

-   Os pinguins Gentoo s√£o, em m√©dia, os mais pesados.
-   Dentro de cada esp√©cie, os machos s√£o consistentemente mais pesados e t√™m bicos mais longo que as f√™meas.

\noindent Esses resultados permitem tirar conclus√µes sobre algumas hip√≥teses biol√≥gicas.

Por fim, a √∫ltima fun√ß√£o que ser√° abordada √© a `recode()`. Muitas vezes, os nomes das categorias nos conjuntos de dados n√£o s√£o ideais para a an√°lise ou apresenta√ß√£o em gr√°ficos. Podem ser longos demais, estarem em outro idioma ou simplesmente n√£o serem claros. Para isso, a fun√ß√£o `recode()` permite renomear valores de uma vari√°vel categ√≥rica de forma simples e direta. Por exemplo, suponha que desejamos traduzir os termos da vari√°vel `sex` da @tbl-tabela-resumo1 para o portugu√™s:

```{r}
#| results: hide
tabela_resumo %>% 
  mutate(
    sex = recode(sex,
                 "female" = "F√™mea",
                 "male" = "Macho")
  ) 
```

```{r}
#| echo: false
#| label: tbl-traduzida
#| tbl-cap: "Tradu√ß√£o da vari√°vel `sexo` da @tbl-tabela-resumo1."
#| tbl-pos: "H"

tabela_resumo %>% 
  mutate(
    sex = recode(sex,
                 "female" = "F√™mea",
                 "male" = "Macho")
  ) %>% 
  kable(
    col.names = c("Esp√©cies", "Sexo", "Contagem",
                  "Massa m√©dia (g)", 
                  "Massa Desvio-padr√£o (g)",
                  "Comprimento m√©dio do bico (mm)"),
    align = c(rep("l", 2), rep("c", 4)),
    booktabs = TRUE,
    format = "latex",
    digits = 2
  ) %>% 
  kable_styling(
    latex_options = c("striped", "scale_down"),
    full_width = FALSE
  ) 
```

As principais fun√ß√µes do pacote `dplyr` que foram vistas est√£o resumidas e descritas na Tabela @tbl-dplyr-fcts e agora que aprendemos como manipular os dados com o `dplyr`, podemos avan√ßar para a constru√ß√£o de gr√°ficos com o pacote `ggplot2`.

```{r}
#| echo: false
#| label: tbl-dplyr-fcts
#| tbl-cap: "Descri√ß√£o das principais fun√ß√µes do `tidyverse`."
#| tbl-pos: "b"

tibble(
  fcts = c("glimpse()", "select()", "filter()", 
           "arrange()", "mutate()", "group_by()", 
           "summarise()", "recode()", "n()"),
  desc = c("Inspecionar conjuntos de dados.",
          "Seleciona colunas pelo nome.",
           "Filtra linhas com base em seus valores.",
           "Reordena as linhas.",
           "Cria novas colunas (vari√°veis).",
           "Agrupa os dados por uma ou mais vari√°veis.",
           "Reduz m√∫ltiplos valores a um √∫nico resumo.",
           "Renomeia categorias de vari√°veis.",
           "Conta o n√∫mero de observa√ß√µes.")
) %>% 
  kable(
    col.names = c("Fun√ß√£o", "Descri√ß√£o"),
    booktabs = TRUE, 
    align = "l"
  ) %>% 
  kable_styling(
    latex_options = c("striped")
  )
```

## Visualiza√ß√£o de Dados com `ggplot2`

Se o `dplyr` √© a gram√°tica da manipula√ß√£o de dados, possuindo fun√ß√µes essenciais para esse trabalho, o `ggplot2` [@wickhamGgplot22016] √© gram√°tica dos gr√°ficos, permitindo construir gr√°ficos por meio de camadas e oferecendo um sistema robusto e flex√≠vel para visualiza√ß√£o os dados. Nesta se√ß√£o, continuaremos utilizando os dados dos pinguins para explorar alguns *insights* visuais, desde gr√°ficos mais simples at√© os mais elaborados.

Todo gr√°fico no `ggplot2` √© constitu√≠do por tr√™s camadas essenciais:

1.  **Dados (`data`):** O *dataframe* que cont√©m as informa√ß√µes a serem plotadas.
2.  **Mapeamento Est√©ticos (`aes`):** A fun√ß√£o `aes()` (de *aesthetics*) descreve como as vari√°veis do nosso *dataframe* s√£o mapeadas para as propriedades visuais do gr√°fico. As est√©ticas mais comuns s√£o `x` e `y` (os eixos), mas tamb√©m incluem `color` (cor), `shape` (forma), `size` (tamanho) e `alpha` (transpar√™ncia/opacidade).
3.  **Camada (`layers`):** O cora√ß√£o de qualquer gr√°fico s√£o as camadas . Elas pegam os dados mapeados e os exibem em algo que os humanos possam entender como uma representa√ß√£o dos dados. Nessa parte que inserimos os objetos geom√©tricos (`geom`): Os `geoms` definem como os dados s√£o representados visualmente. Por exemplo, `geom_point()` cria um gr√°fico de dispers√£o, `geom_bar()` cria um gr√°fico de barras, `geom_line()` cria um gr√°fico de linhas, e assim por diante.

![Na imagem, temos todas as camadas que s√£o utilizadas pelo ggplot2, seguindo a ordem debaixo para cima](images/ggplot2.png){fig-align="center" width="452"}

Al√©m das tr√™s camadas essenciais (dados, mapeamento est√©tico e objetos geom√©tricos), o `ggplot2` permite adicionar outras camadas para refinar e personalizar seus gr√°ficos:

-   **Camada da Escala (`scales`)**: Essa camada controla o mapeamento entre os valores dos dados e as propriedades visuais. Por exemplo, ela define a cor, o tamanho e a forma dos objetos, al√©m de permitir a personaliza√ß√£o dos eixos (como a defini√ß√£o de limites e r√≥tulos).

-   **Camada de Subdivis√£o (`facets`)**: As facetas s√£o uma maneira de criar m√∫ltiplos gr√°ficos, dividindo seus dados em subgrupos com base em uma ou mais vari√°veis. Elas s√£o ideais para explorar rela√ß√µes condicionais nos dados. `facet_wrap()` e `facet_grid()` s√£o as fun√ß√µes mais comuns para essa finalidade.

-   **Camada do Sistema de Coordenadas (`coord`)**: Esta camada define como os dados s√£o mapeados para a superf√≠cie do gr√°fico. A coordenada padr√£o √© a Cartesiana, mas voc√™ pode usar outras, como `coord_polar()` para gr√°ficos de pizza ou `coord_flip()` para inverter os eixos x e y.

-   **Camada do Tema (`theme`)**: O tema controla os elementos n√£o relacionados aos dados, como as fontes, as cores de fundo, os r√≥tulos dos eixos e as legendas. √â o que permite dar uma apar√™ncia mais profissional e personalizada aos seus gr√°ficos.

Ao combinar essas camadas de maneira l√≥gica, o `ggplot2` oferece um sistema flex√≠vel para a constru√ß√£o de gr√°ficos, permitindo que voc√™ adicione complexidade gradualmente, mantendo o c√≥digo organizado e leg√≠vel.

### Estat√≠stica descritiva

Antes de explorar as rela√ß√µes gr√°ficas, √© √∫til enfatizar e entender alguns conceitos essenciais da Estat√≠stica Descritiva como os tipos de vari√°veis, normas para tabelas e as defini√ß√µes de frequ√™ncias.

<!-- Antes de explorar as rela√ß√µes gr√°ficas, √© √∫til enfatizar e entender as diferen√ßas entre os tipos de vari√°veis e suas distribui√ß√µes individuais poss√≠veis. Em geral, pode-se dizer que existem duas categorias de vari√°veis dentro da estat√≠stica: -->

Em geral, pode-se dizer que existem duas categorias de vari√°veis dentro da estat√≠stica:

1.  **Vari√°veis Qualitativas**: Tamb√©m chamadas por vari√°veis categ√≥ricas e como o pr√≥prio nome diz, expressam qualidade e indicam categoria ou classifica√ß√£o a qual o objeto pertence. Se existir uma ordem entre as poss√≠veis categorias, a vari√°vel √© dita **qualitativa ordinal**. Caso contr√°rio, √© dita ser **qualitativa nominal**.
2.  **Vari√°veis Quantitativas**: S√£o vari√°veis que tomam valores num√©ricos e expressam quantidade. Podem ser especificadas por **Vari√°veis Discretas**, quando assumem valores dentro de um conjunto enumer√°vel (quando √© poss√≠vel cont√°-las) ou por **Vari√°veis Continuas**, quando podem assumir infinitos valores de um intervalo n√£o numer√°vel[^03-tidyverse-2] (n√£o √© poss√≠vel contar o n√∫mero de valores dentro de um intervalo).

[^03-tidyverse-2]: Tente contar os n√∫meros do conjunto $A = \{1,2,3,4\}$ e, tamb√©m, de $B = [1,4]$. Observe que no conjunto $A$ h√° 4 elementos, enquanto em $B$ h√° infinitos valores de 1 a 4.

Assim, para explorar e apresentar as informa√ß√µes contidas num conjunto de dados, precisamos resumir essas informa√ß√µes de forma que seja poss√≠vel enxerg√°-las rapidamente e adquirir conhecimento sobre o assunto.

O resumo pode ser feito por meio de tabelas, gr√°ficos e c√°lculo de algumas quantidades representativas. O primeiro passo √© identificar o tipo de cada vari√°vel para aplicarmos a t√©cnica apropriada.

No entanto, antes de explorarmos a organiza√ß√£o dos dados em tabelas e gr√°ficos, s√£o necess√°rios conceitos sobre algumas m√©tricas essenciais denominadas por medidas resumo. Elas oferecem uma forma num√©rica e concisa de descrever as principais caracter√≠sticas das vari√°veis que ser√£o trabalhadas. Em geral, s√£o divididas em duas categorias essenciais: as medidas de tend√™ncia central, que informam onde o "centro" dos dados se localiza (como a m√©dia, mediana e moda), e as medidas de dispers√£o, que quantificam o qu√£o espalhados os dados est√£o (como a amplitude, o desvio padr√£o e a vari√¢ncia).

A **m√©dia aritm√©tica** √© definida como sendo a soma de todos os valores dividida pelo n√∫mero de observa√ß√µes ou indiv√≠duos, ou seja, denotando-se as $n$ observa√ß√µes de uma vari√°vel $X$ por $x_1, x_2, \dots, x_n$ e a m√©dia por $\bar{x}$ temos: $$\bar{x} = \frac{1}{n}\sum_{i = 1}^{n} x_i$$ As principais propriedades da m√©dia s√£o:

-   √â uma medidas simples e popular;
-   √â sens√≠vel aos valores e discrepantes ou extremos. Portanto, na presen√ßa destes, a m√©dia pode n√£o ser uma representa√ß√£o de valores t√≠picos;
-   √â o ponto de equil√≠brio da distribui√ß√£o;
-   Para $k$ constante e $X$ vari√°vel, t√™m-se que a m√©dia de $(X + k)$ √© $(\bar{x} + k)$ e, tamb√©m, a m√©dia de $(kX)$ √© $(k\bar{x})$.
-   Para $X$ e $Y$ vari√°veis independentes, a m√©dia de $(X\pm Y)$ √© $(\bar{x} \pm \bar{y})$.

A **mediana** √© o valor do meio de uma distribui√ß√£o, ou seja, num histograma, √© o valor que deixa exatamente 50% dos dados de cada lado. Para determinar o valor exato da mediana √© necess√°rio ordenar todos os valores, do menor para o maior. Se $n$, o n√∫mero de observa√ß√µes, √© √≠mpar ent√£o a mediana √© o valor que fica exatamente no centro; se $n$ √© par, ent√£o √© a m√©dia dos dois valores centrais.

As principais propriedades da mediana s√£o:

-   N√£o √© sens√≠vel a valores discrepantes e, portanto, √© a mais apropriada para representar valores t√≠picos quando a distribui√ß√£o √© assim√©trica;
-   N√£o apresenta as propriedades matem√°ticas convenientes que a m√©dia possui.

Quando a distribui√ß√£o √© sim√©trica, m√©dia e mediana s√£o iguais. No entanto, caso contr√°rio, a m√©dia estar√° mais afastada do meio que a mediana no sentido de uma cauda mais longa.

A **moda** √© simplesmente o valor mais frequente da vari√°vel de estudo e para distribui√ß√µes sim√©tricas, m√©dia, mediana e moda possuem valores iguais.

Uma vez reconhecido o centro da distribui√ß√£o, √© necess√°rio ter uma ideia do quanto os valores est√£o distantes deste centro. Quanto mais heterog√™neo forem os dados, maior a dispers√£o e vice-versa. Dentre as m√©tricas que d√£o essa ideia, destacam-se:

A **amplitude** definida pela diferen√ßa entre o maior e o menor valor. Al√©m disso, √© sens√≠vel a valores extremos. O **primeiro quartil** ($q_1$) e **terceiro quartil** ($q_3$), que dividem, respectivamente, o conjunto de dados em 25% e 75%. √â v√°lido ressaltar que todo conjunto de dados apresentam 3 quartis, dividindo o conjunto ordenado em quatro partes iguais, al√©m disso, o segundo quartil ($q_2$) √© igual a mediana. Essas medidas s√£o √∫teis na constru√ß√£o do gr√°fico de caixa (*boxplot*) que ser√° visto em sequ√™ncia.

O **desvio padr√£o** ($s$) √© a medida de dispers√£o mais popular e mede a dispers√£o de todos os valores em rela√ß√£o √† m√©dia. Para calcul√°-lo, primeiramente calcula-se a **vari√¢ncia**, denotada por $s^2$, que √© definida por: $$s^2 = \mathbb{V}(X) = \frac{1}{n-1}\sum_{i = 1}^{n}(x_i - \bar{x})^2 = \frac{1}{n-1}\left(\sum_{i = 1}^{n}x_i^2 - \frac{\left(\sum_{i = 1}^{n} x_i\right)^2}{n}\right)$$ a diferen√ßa $(x_i - \bar{x})$ √© chamada de desvio, representando o quanto o indiv√≠duo $i$ desviou da m√©dia geral. A vari√¢ncia representa a m√©dia dos quadrados dos desvios em rela√ß√£o √† m√©dia. Al√©m disso, observe que a unidade de medida da vari√¢ncia √© a unidade da vari√°vel $x$ ao quadrado, dificultando sua interpreta√ß√£o e, para lidar com isso, utiliza-se o desvio-padr√£o, visto que √© seu valor est√° na mesma escala de medida das observa√ß√µes, em que valores altos indica que os dados est√£o bastante dispersos e valores baixos, os indiv√≠duos est√£o pr√≥ximos da m√©dia, mostrando uma homogeneidade nos dados. As principais propriedades da vari√¢ncia (ou do desvio padr√£o) s√£o:

-   Para $k$ constante, $\mathbb{V}(k) = 0$, $\mathbb{V}(k + X) = \mathbb{V}(X)$, $\mathbb{V}(kX) = k^2\mathbb{V}(X)$;
-   Para $X$ e $Y$ vari√°veis independentes, $\mathbb{V}(X \pm Y) = \mathbb{V}(X) + \mathbb{V}(Y)$;
-   √â sens√≠vel aos valores discrepantes e, portanto, s√≥ deve ser usada quando a distribui√ß√£o √© sim√©trica ou aproximadamente sim√©trica.

Por fim, existe o **coeficiente** de vari√ß√£o ($\text{cv}$), que √© uma medida de dispers√£o em termos de porcentagem da m√©dia: $$\text{cv} = \frac{s}{\bar{x}}\times 100,$$ em que n√£o h√° unidade de medida e, portanto, serve como m√©trica de compara√ß√£o na varia√ß√£o de vari√°veis diferentes.

Dentro do R, a fun√ß√£o `summary()` √© a chave mestre que calcula quase todas as m√©tricas que foram vistas. Para exemplificar, selecionaremos apenas a vari√°vel `bill_length` do conjunto de dados `penguins` (@tbl-summary).

```{r}
#| results: hide

penguins %>% 
  select(bill_length_mm) %>% 
  summary()
```

```{r}
#| echo: false
#| tbl-pos: H
#| tbl-cap: "Sa√≠da da fun√ß√£o `summary()`"
#| label: tbl-summary

penguins %>% 
  summarise(
    x = "bill_length_mm",
    min     = min(bill_length_mm, na.rm = TRUE),
    quad1 = quantile(bill_length_mm, 0.25, na.rm = TRUE),
    mediana = median(bill_length_mm, na.rm = TRUE),
    media   = mean(bill_length_mm, na.rm = TRUE),
    quad3 = quantile(bill_length_mm, 0.75, na.rm = TRUE),
    max     = max(bill_length_mm, na.rm = TRUE),
    na    = sum(is.na(bill_length_mm))
  ) %>%
  select(x, everything()) %>% 
  kable(
    col.names = c("Vari√°vel", "Min", "1¬∫ Quad.", "Mediana", "M√©dia",
                  "3¬∫ Quad.", "Max", "NAs"),
    booktabs = TRUE,
    align = c("l", rep("c", 7))
  ) %>% 
  kable_styling("striped")
```

Enquanto as medidas resumo nos fornecem valores pontuais para compreens√£o do centro e a dispers√£o, as tabelas oferecem uma vis√£o panor√¢mica da distribui√ß√£o dos dados. Organizar as informa√ß√µes de forma tabular √© o primeiro para visualizar as frequ√™ncias de cada categoria ou intervalo, complementando a an√°lise num√©rica anterior.

As normas gerais para constru√ß√£o de uma tabela envolvem:

-   Devem ser auto-explicativas.
-   Devem conter um t√≠tulo, que precisa ser simples e claro, indicando informa√ß√µes sobre os dados (do que, onde e quando foram coletados -- se forem relevantes).

Al√©m das normas gerais, existem duas conven√ß√µes importantes a serem seguidas com rela√ß√£o ao t√≠tulo de tabelas e gr√°ficos:

-   Em **tabelas** os t√≠tulos vem primeiro, em cima da tabela.
-   Em **gr√°ficos** os t√≠tulos vem por √∫ltimo, embaixo do gr√°fico.

Se necess√°rio, notas e fontes v√™m embaixo, em ambos os casos. Uma tabela come√ßa e termina com um tra√ßo horizontal e tra√ßos na vertical devem ser evitados, conforme visto na @tbl-tabela-resumo1 por exemplo.

Uma forma adequada para resumir informa√ß√µes sobre uma vari√°vel numa tabela √© atrav√©s da constru√ß√£o de uma **tabela de frequ√™ncias**, que informa quais valores ou categorias a vari√°vel pode tomar, com suas respectivas frequ√™ncias. Quando a vari√°vel √© qualitativa, as frequ√™ncias v√£o revelar se temos categorias mais comuns (t√≠picas) e categorias raras ou se a distribui√ß√£o √© uniforme/homog√™nea. J√° quando a vari√°vel √© quantitativa, as frequ√™ncias revelar√£o os valores t√≠picos e/ou a distribui√ß√£o dos valores √© sim√©tricas ou assim√©trica.

Existem alguns tipos de frequ√™ncia que podem ser utilizados para resumir as informa√ß√µes, dentre eles:

-   Frequ√™ncia absoluta ou simplesmente frequ√™ncia ($f$): √© a contagem do n√∫mero de vezes que um valor ou categoria aparece.
-   Frequ√™ncia relativa ($\text{fr} = f/n$): quando esse valor √© multiplicado por $100$, informa a porcentagem do aparecimento de uma determinada categoria sobre o n√∫mero total de contagem.
-   Frequ√™ncia acumulada ($\text{fa}$): √© a frequ√™ncia acumulada at√© um valor espec√≠fico.
-   Frequ√™ncia acumulada relativa ($\text{far} = \text{fa}/n$): quando esse valor √© multiplicado por $100$, informa a porcentagem acumulada do aparecimento de uma determinada categoria sobre o n√∫mero total de contagem.

A @tbl-freq-pin cont√©m as informa√ß√µes sobre as frequ√™ncias de cada esp√©cie de pinguim existente no conjunto de dados `penguins`. As informa√ß√µes b√°sicas que podem ser extra√≠das √© que entre as esp√©cies dentro do estudo sobre pinguins 44.2% s√£o *Adelie*, 36% s√£o *Gentoo* e 19.8% s√£o *Chinstrap*.

```{r}
#| echo: false
#| tbl-cap: "Distribui√ß√£o de frequ√™ncias para as esp√©cies de Pinguins."
#| label: tbl-freq-pin
#| tbl-pos: "H"

penguins %>% 
  count(species, name = "freq") %>% 
  mutate(
    freq.r = round(freq/sum(freq), 3),
    porc = paste0(round(freq.r*100,3), "\\%")
  ) %>% 
  arrange(desc(freq)) %>% 
  as_tibble() %>% 
  bind_rows(
    tibble(
      species = "Total",
      freq = sum(penguins %>% count(species) %>% select(n)),
      freq.r = round(1, 3),
      porc = "100\\%"
    )
  ) %>% 
  kable(
    col.names = c(
      "Esp√©cies",
      "Frequ√™ncia",
      "Frequ√™ncia absoluta",
      "Porcentagem"
      ),
    booktabs = TRUE,
    align = c("lccc"),
    escape = FALSE
  ) %>% 
  kable_styling(
    latex_options = c("striped")
  ) %>% 
  row_spec(3, extra_latex_after = "\\midrule")
```

Quando a vari√°vel √© quantitativa e assume muitos valores distintos, para resumir e capturar o padr√£o da distribui√ß√£o, esses valores devem ser agrupados em intervalos. A quantidade de intervalos √© arbitr√°rio, no entanto, n√£o pode ser nem muito baixo e nem muito alto. O pr√≥ximo passo √© especificar os intervalos, contando quantos valores aparecem dentro de cada um deles.

Para exemplificar, utilizaremos a vari√°vel `body_mass_g` de nosso conjunto de dados sobre os pinguins. Em geral, segue-se os passos:

1.  Calcular a amplitude ($A$) dos dados.

```{r}
penguins %>% 
  summarise(
    maior = max(body_mass_g, na.rm = TRUE),
    menor = min(body_mass_g, na.rm = TRUE),
    amplitude = max(body_mass_g, na.rm = TRUE) - min(body_mass_g, na.rm = TRUE))

# Ou ainda
A <- penguins %>% 
  summarise(
    amplitude = diff(range(body_mass_g, na.rm = TRUE))
  )
```

2.  Encontrar o comprimento aproximado de cada intervalo, dividindo $A$ pelo n√∫mero de intervalos desejados.

```{r}
A/6
```

A partir da @tbl-freq-abs-pin e pela coluna das frequ√™ncias relativas, observa-se que a distribui√ß√£o do peso √© assim√©trica. Em breve, isso ser√° observado graficamente.

```{r}
#| echo: false
#| tbl-cap: "Distribui√ß√£o de frequ√™ncias para a massa corporal (g) dos pinguins."
#| label: tbl-freq-abs-pin
#| tbl-pos: "H"

penguins %>%
  filter(!is.na(body_mass_g)) %>%
  {
    brks <- seq(2700, 6300, by = 600)
    brks[length(brks)] <- brks[length(brks)] + 1e-8
    labs <- sprintf("%d $\\vdash$ %d", 
                    seq(2700, 6300 - 600, by = 600),
                    seq(2700 + 600, 6300, by = 600))

    cut(x = .$body_mass_g,
        breaks = brks,
        right = FALSE, include.lowest = TRUE,
        labels = labs) %>% 
      as_tibble_col(column_name = "Intervalo") %>% 
      count(Intervalo, name = "freq", .drop = FALSE) %>% 
      mutate(
        fr = paste0(round(freq / sum(freq) * 100, 2), "\\%"),
        far = paste0(round(cumsum(freq) / sum(freq) * 100, 2), "\\%")
      ) %>% 
      kable(
        col.names = c("Massa corporal (g)", "Frequ√™ncia", "f.r. (\\%)", "f.a.r. (\\%)"),
        booktabs = TRUE,
        align = c("lccc"),
        escape = FALSE
      ) %>% 
      kable_styling(latex_options = "striped")
  }
```

### Tipos de gr√°ficos

As distribui√ß√µes de frequ√™ncias podem ser representadas em gr√°ficos, que facilitam a interpreta√ß√£o visual do comportamento dos dados. Os gr√°ficos mais comuns, segundo o tipo de vari√°vel, s√£o:

-   Barras ou colunas: apropriado para vari√°veis qualitativas e quantitativas discretas.
-   Setores: qualitativas nominais com poucas categorias.
-   Histograma: qualitativas cont√≠nuas.
-   Box-plot: quantitativas.
-   Diagrama de dispers√£o: relaciona duas quantitativas.
-   Gr√°fico de linhas: evolu√ß√£o de quantitativa ao longo do tempo ou espa√ßo.

Com esse conhecimento em mente podemos prosseguir para as constru√ß√µes dos gr√°ficos.

O pacote `ggplot2` funciona com constru√ß√£o de "camadas" (layers). O comando `ggplot()` inicia um gr√°fico vazio.

```{r}
ggplot()
```

A partir deste gr√°fico vazio, podemos adicionar camadas de pontos, linhas, barras, caixas, entre outros. D√™ uma olhada no [manual de refer√™ncia](https://cran.r-project.org/web/packages/ggplot2/ggplot2.pdf). Outros como [tidyverse](https://ggplot2.tidyverse.org/), ou [Curso de R](https://livro.curso-r.com/8-1-o-pacote-ggplot2.html) podem ajudar bastante! Explore o m√°ximo.

#### Adicionando layers

De maneira geral, a sintaxe que vamos usar √© `geom_yyy(data = dados, aes(x = x, y = y))`, sendo que iremos substituir `yyy` por "line" para linhas, "point" para pontos e assim por diante.

Para praticar um pouco, podemos fazer uma visualiza√ß√£o da rela√ß√£o entre a **massa corporal** (eixo X) e o **comprimento da nadadeira** (eixo Y):

```{r plot2, exercise=TRUE}
ggplot(penguins_completo) +
  geom_point(aes(x = body_mass_g, y = flipper_length_mm))
```

Se quisermos que os pontos tenham uma cor em particular, adicionamos a cor dentro de `geom_point()`.

```{r plot3, exercise=TRUE}
ggplot(data = penguins_completo) +
  geom_point(aes(x = body_mass_g, y = flipper_length_mm), color = "blue")
```

Ou ainda, podemos utilizar a l√≥gica do tidyverse e aplicar um pipe para criar nosso gr√°fico.

```{r}
penguins_completo %>% 
  ggplot() +
  geom_point(aes(x = body_mass_g, y = flipper_length_mm), color = "blue")
```

A cor de cada ponto tamb√©m pode ser definida por uma vari√°vel (como a esp√©cie), mas precisar√° ser inserida dentro de `aes()`.

```{r}
penguins_completo %>% 
  ggplot() +
  geom_point(aes(x = body_mass_g, y = flipper_length_mm, color = species))
```

Com a l√≥gica fundamental do `ggplot2` em mente, vamos agora explorar algumas visualiza√ß√µes comuns para analisar nossos dados.

#### Visualizando uma √∫nica vari√°vel

Para visualizar a distribui√ß√£o de uma vari√°vel cont√≠nua como a massa corporal, utiliza-se o histograma com a fun√ß√£o `geom_histogram()`. Como j√° foi visto, a escolha do n√∫mero de colunas √© arbitr√°rio e pode afetar significativamente a apar√™ncia e a interpreta√ß√£o do gr√°fico.

```{r}
#| warning: false
#| fig-cap: "Distribui√ß√£o da massa corporal (g) dos pinguins."
#| fig-width: 6
#| fig-height: 2.75

penguins %>% 
  ggplot(mapping = aes(x = body_mass_g))+
    geom_histogram()

```

Mas esse gr√°fico √© muito feio, vamos ver como melhorar.

```{r}
#| warning: false
#| fig-cap: "Distribui√ß√£o da massa corporal (g) dos pinguins."
#| fig-width: 6
#| fig-height: 2.75

penguins %>% 
  ggplot(mapping = aes(x = body_mass_g))+
    geom_histogram(color = "white", fill = "steelblue",
                   breaks = seq(2700, 6300, by = 600), 
                   closed = "left")+
    scale_x_continuous(
      breaks = seq(2700, 6300, by = 600),
      labels = seq(2700, 6300, by = 600),
      limits = c(2700, 6300)
    )+
    labs(
      x = "Massa corporal (g)",
      y = "Contagem"
    )+
    ggthemes::theme_clean()
```

Observe que a biblioteca `ggthemes` foi utilizada para melhorar o aspecto est√©tico do gr√°fico, fornecendo temas adicionais. Portanto, √© recomend√°vel instal√°-la e carreg√°-la no espa√ßo de trabalho.

```{r}
# install.packages("ggthemes")
library(ggthemes)
```

Para vari√°veis categ√≥ricas, como `species`, usamos o `geom_bar()` para criar um gr√°fico de barras que mostra a contagem de observa√ß√µes em cada categoria.

```{r}
#| fig-cap: "Distribui√ß√£o de Pinguins por Esp√©cie."
#| fig-width: 6
#| fig-height: 2.75

penguins %>% 
  ggplot(mapping = aes(x = species, fill = species))+
    geom_bar()+
    labs(
      x = "Esp√©cies",
      y = "N√∫mero de Indiv√≠duos"
    )+
    labs(
        x = "Esp√©cies",
        y = "Contagem",
        fill = "Esp√©cies"
      )+
    theme_clean()+
    theme(legend.position = "bottom")
```

#### Rela√ß√µes entre vari√°veis

O gr√°fico de dispers√£o √© a ferramenta cl√°ssica para explorar rela√ß√µes entre duas vari√°veis num√©ricas. Investigaremos a rela√ß√£o existente entre o comprimento da nadadeira e a massa corporal. A hip√≥tese √© que pinguins com nadadeiras maiores tamb√©m ser√£o mais pesados, uma rela√ß√£o positiva e intuitiva que serve como um excelente par√¢metro de partida. Como vimos anteriormente, o gr√°fico dessa rela√ß√£o fica da seguinte forma:

```{r}
#| warning: false
#| fig-cap: "Rela√ß√£o entre o tamanho da nadadeira (mm) e o peso corporal (g) dos pinguins."
#| label: fig-dis-peso-nad

penguins %>% 
  ggplot(aes(x = flipper_length_mm, y = body_mass_g))+
    geom_point()+
    labs(
      x = "Comprimento da Nadadeira (mm)",
      y = "Mass corporal (g)"
    )+
  theme_clean()
```

\noindent A @fig-dis-peso-nad informa uma clara tend√™ncia positiva entre a nadadeira e o peso corporal dos pinguins. Mas ser√° que esse tend√™ncia √© a mesma para todas as esp√©cies? Para responder essa pergunta, atrav√©s da fun√ß√£o `aes()`, √© poss√≠vel adicionar est√©ticas adicionais como `shape`, `color` ou `size` para distinguir as esp√©cies no gr√°fico. O argumento a ser utilizado depender√° onde a imagem ser√° utilizada. Por exemplo, em uma revista cient√≠fica, que solicita gr√°ficos em preto e branco, √© aconselh√°vel utilizar `shape` ou `size`.

```{r}
#| warning: false
#| fig-cap: "Rela√ß√£o entre o tamanho da nadadeira (mm) e o peso corporal (g) por esp√©cie dos pinguins."
#| label: fig-dis-esp

penguins %>% 
  ggplot(aes(x = flipper_length_mm, y = body_mass_g, color = species))+
    geom_point()+
    labs(
      x = "Comprimento da Nadadeira (mm)",
      y = "Massa corporal (g)",
      color = "Esp√©cies"
    )+
    theme_clean()+
    theme(legend.position = "bottom")
```

\noindent A @fig-dis-esp revela detalhes mais pertinentes, mostrando que a rela√ß√£o entre massa corporal e comprimento da nadadeira mant√™m-se positiva (n√≠vel de grupo).

Para comparar a distribui√ß√£o de uma vari√°vel num√©rica entre diferentes categorias, o boxplot[^03-tidyverse-3] (`geom_boxplot()`) √© uma excelente ferramenta. Para isso, vamos comparar a distribui√ß√£o da massa corporal entre as tr√™s esp√©cies.

[^03-tidyverse-3]: Tamb√©m chamado por gr√°fico de caixas.

```{r}
#| warning: false
#| fig-cap: "Boxplot para a massa corporal (g) por esp√©cies de pinguins."

penguins %>% 
  ggplot(aes(x = species, y = body_mass_g, fill = species))+
    geom_boxplot()+
    labs(
      x = "Esp√©cies",
      y = "Massa corporal (g)",
      fill = "Esp√©cies"
    )+
    theme_clean()+
    theme(legend.position = "none")
```

Uma alternativa ao `geom_boxplot()` √© o `geom_violin()`, que traz um detalhamento sobre os dados de uma maneira mais simples. Adicionalmente, podemos utilizar o `geom_jitter()` para evitar a sobreposi√ß√£o dos dados, enriquecendo o visual do gr√°fico.

```{r}
#| warning: false
penguins %>% 
  ggplot(aes(x = species, y = body_mass_g, fill = species))+
    geom_violin(alpha = 0.5)+
    geom_jitter(width = 0.1, alpha = 0.5)+
    labs(
      x = "Esp√©cie",
      y = "Massa corporal (g)"
    )+
    theme_clean()+
    theme(legend.position = "none")
```

### T√©cnicas avan√ßadas de visualiza√ß√£o e comunica√ß√£o

Com a base da constru√ß√£o de gr√°ficos vista anteriormente, √© poss√≠vel explorar t√©cnicas para criar gr√°ficos mais ricos e informativos, complementando informa√ß√µes descobertas de forma eficaz.

### Sub-gr√°ficos com `facet_wrap()`

As facetas permitem criar uma matriz de gr√°ficos, dividindo os dados com uma base em uma ou mais vari√°veis categ√≥ricas. Isso √© extremamente √∫til para compara√ß√µes. Para exemplificar, vamos utilizar o gr√°fico de dispers√£o e segment√°-lo para a vari√°vel `sex`.

```{r}
#| warning: false
#| fig-cap: "Distribui√ß√£o de massa corporal (g) por esp√©cie."

penguins %>% 
  filter(!is.na(sex)) %>% 
  mutate(
  sex = recode(sex,
         "female" = "F√™mea",
         "male" = "Macho")
  ) %>% 
  ggplot(aes(x = flipper_length_mm, y = body_mass_g, color = species))+
    geom_point()+
    facet_wrap(~ sex)+
    labs(
      x = "Comprimento da nadadeira (mm)",
      y = "Massa corporal (g)",
      color = "Esp√©cies"
    )+
    theme_clean()+
    theme(legend.position = "bottom")
```

\noindent Neste gr√°fico, fica evidente que os pinguins f√™meas possuem menos massa corporal que os machos e, quanto as esp√©cies, `Gentoo` √© que concentra a maior massa. Contudo, pode ser do interesse do pesquisador al√©m de verificar a massa corporal por sexo, tamb√©m incluir a vari√°vel `island`.

```{r}
#| warning: false
#| fig-cap: "Distribui√ß√£o de massa corporal (g) nas ilhas por esp√©cie."
#| label: fig-massa-ilha
#| fig-height: 5

penguins %>% 
  filter(!is.na(sex)) %>% 
  mutate(
  sex = recode(sex,
         "female" = "F√™mea",
         "male" = "Macho")
  ) %>% 
  ggplot(aes(x = flipper_length_mm, y = body_mass_g, color = species))+
    geom_point()+
    facet_wrap(island ~ sex)+
    labs(
      x = "Comprimento da nadadeira (mm)",
      y = "Massa corporal (g)",
      color = "Esp√©cies"
    )+
    theme_clean()+
    theme(legend.position = "bottom")
```

\noindent A partir da @fig-massa-ilha √© poss√≠vel reparar que nem todas as esp√©cies est√£o presentes nas tr√™s ilhas simultaneamente. Al√©m disso, a ilha de `Biscoe` √© a que apresenta o maior percentual de massa corporal dos pinguins, isto √©, a esp√©cie `Gentoo` √© a predominante.
